<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostic</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 2rem;
            background: #1e1e1e;
            color: #00ff00;
        }

        h1 {
            color: #00ffff;
        }

        .test {
            margin: 1rem 0;
            padding: 1rem;
            background: #2a2a2a;
            border-left: 4px solid #00ff00;
        }

        .test.error {
            border-left-color: #ff0000;
            color: #ff5555;
        }

        .test.success {
            border-left-color: #00ff00;
        }

        .test h3 {
            margin: 0 0 0.5rem 0;
            color: #ffff00;
        }

        pre {
            background: #000;
            padding: 1rem;
            overflow-x: auto;
            color: #aaa;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: bold;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }

        button:hover {
            background: #00cc00;
        }
    </style>
</head>

<body>
    <h1>üî• Firebase Diagnostic Tool</h1>

    <div id="results"></div>

    <button onclick="testFirebaseSDK()">1. Test Firebase SDK</button>
    <button onclick="testFirebaseInit()">2. Test Firebase Init</button>
    <button onclick="testFirestoreRead()">3. Test Firestore Read</button>
    <button onclick="uploadDefaults()">4. Upload Default Products</button>
    <button onclick="location.reload()">‚Üª Refresh</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCelAVlCt8rGTROwpUOh8viOEYqsJI4vrs",
            authDomain: "wsl-interiors.firebaseapp.com",
            projectId: "wsl-interiors",
            storageBucket: "wsl-interiors.firebasestorage.app",
            messagingSenderId: "626511180358",
            appId: "1:626511180358:web:499c86d89adddd9db39047",
            measurementId: "G-MCZKXWC2C8"
        };

        let db, auth;
        const resultsDiv = document.getElementById('results');

        function addResult(title, message, isError = false) {
            const div = document.createElement('div');
            div.className = `test ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h3>${isError ? '‚ùå' : '‚úÖ'} ${title}</h3>
                <pre>${message}</pre>
            `;
            resultsDiv.appendChild(div);
        }

        function testFirebaseSDK() {
            resultsDiv.innerHTML = '';
            if (typeof firebase !== 'undefined') {
                addResult('Firebase SDK Loaded', `Firebase version: ${firebase.SDK_VERSION || 'Unknown'}`);
            } else {
                addResult('Firebase SDK NOT Loaded', 'Firebase object is undefined', true);
            }
        }

        function testFirebaseInit() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                addResult('Firebase Initialized', 'Firebase app, Firestore, and Auth initialized successfully');
            } catch (error) {
                if (error.code === 'app/duplicate-app') {
                    addResult('Firebase Already Initialized', 'Firebase was already initialized (this is OK)');
                    db = firebase.firestore();
                    auth = firebase.auth();
                } else {
                    addResult('Firebase Initialization Failed', error.message, true);
                }
            }
        }

        function testFirestoreRead() {
            if (!db) {
                addResult('Firestore Not Ready', 'Please run Test 2 first', true);
                return;
            }

            addResult('Firestore Read Test', 'Attempting to read products collection...');

            db.collection('products').get()
                .then((snapshot) => {
                    if (snapshot.empty) {
                        addResult('Products Collection Empty', 'No products found in Firestore. Click "Upload Default Products" to create them.');
                    } else {
                        const products = [];
                        snapshot.forEach(doc => {
                            products.push({ id: doc.id, ...doc.data() });
                        });
                        addResult('Products Retrieved',
                            `Found ${snapshot.size} product(s):\n${JSON.stringify(products, null, 2)}`
                        );
                    }
                })
                .catch((error) => {
                    addResult('Firestore Read FAILED',
                        `Error: ${error.message}\n\nThis usually means:\n1. Firestore Security Rules are blocking access\n2. Network/CORS issues\n\nGo to Firebase Console ‚Üí Firestore Database ‚Üí Rules\nAnd temporarily set:\nallow read, write: if true;`,
                        true
                    );
                });
        }

        function uploadDefaults() {
            if (!db) {
                addResult('Firestore Not Ready', 'Please run Test 2 first', true);
                return;
            }

            const defaultProducts = [
                {
                    id: 1,
                    name: "Modern Velvet Sofa",
                    price: 1299,
                    category: "Living Room",
                    image: "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1000&auto=format&fit=crop"
                },
                {
                    id: 2,
                    name: "Minimalist Wooden Table",
                    price: 499,
                    category: "Dining",
                    image: "https://images.unsplash.com/photo-1530018607912-eff2daa1bac4?q=80&w=1000&auto=format&fit=crop"
                },
                {
                    id: 3,
                    name: "Industrial Pendant Light",
                    price: 199,
                    category: "Lighting",
                    image: "https://images.unsplash.com/photo-1513506003901-1e6a229e2d15?q=80&w=1000&auto=format&fit=crop"
                },
                {
                    id: 4,
                    name: "Scandinavian Accent Chair",
                    price: 349,
                    category: "Decor",
                    image: "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?q=80&w=1000&auto=format&fit=crop"
                }
            ];

            addResult('Uploading Products', 'Starting upload of default products...');

            let successCount = 0;
            let errorCount = 0;

            defaultProducts.forEach(p => {
                db.collection('products').doc(String(p.id)).set(p)
                    .then(() => {
                        successCount++;
                        if (successCount + errorCount === defaultProducts.length) {
                            addResult('Upload Complete',
                                `Successfully uploaded ${successCount} product(s)\nFailed: ${errorCount}\n\nRefresh the shop page to see them!`
                            );
                        }
                    })
                    .catch(e => {
                        errorCount++;
                        if (successCount + errorCount === defaultProducts.length) {
                            addResult('Upload Failed',
                                `Error: ${e.message}\n\nThis means Firestore Security Rules are blocking WRITE access.\nGo to Firebase Console and set: allow read, write: if true;`,
                                true
                            );
                        }
                    });
            });
        }

        // Auto-run first two tests on load
        window.addEventListener('DOMContentLoaded', () => {
            testFirebaseSDK();
            setTimeout(() => testFirebaseInit(), 500);
        });
    </script>
</body>

</html>